<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>创建地图场景</title>
    <style>
        html,
        body {
            overflow: hidden;
            margin: 0;
        }
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/@antv/l7"></script>
<script>
    const scene = new L7.Scene({
        id: "map",
        map: new L7.Earth({})
    });


    const earthlayer = new L7.EarthLayer()
        .source(
            'https://gw.alipayobjects.com/mdn/rms_23a451/afts/img/A*3-3NSpqRqUoAAAAAAAAAAAAAARQnAQ',
            {
                parser: {
                    type: 'image'
                }
            }
        )
        .shape('fill')
        .style({
            opacity: 1.0,
            radius: 40,
            globelOtions: {
                ambientRatio: 0.6, // 环境光
                diffuseRatio: 0.4, // 漫反射
                specularRatio: 0.1 // 高光反射
            }
        })
        .animate(true);


    const atomLayer = new L7.EarthLayer()
        .color('#2E8AE6')
        .shape('atomSphere')
        .style({
            opacity: 1
        });

    const bloomLayer = new L7.EarthLayer().color('#fff').shape('bloomSphere')
        .style({
            opacity: 0.6
        });

    fetch(
        "https://gw.alipayobjects.com/os/rmsportal/oVTMqfzuuRFKiDwhPSFL.json"
    )
        .then(res => res.json())
        .then(data => {
            const pointLayer = new L7.PointLayer({})
                .source(data.list, {
                    parser: {
                        type: "json",
                        x: "j",
                        y: "w"
                    }
                })
                .shape("cylinder")
                .size("t", function(level) {
                    return [1, 2, level * 2 + 20];
                })
                .color("t", [
                    "#094D4A",
                    "#146968",
                    "#1D7F7E",
                    "#289899",
                    "#34B6B7",
                    "#4AC5AF",
                    "#5FD3A6",
                    "#7BE39E",
                    "#A1EDB8",
                    "#CEF8D6"
                ])
                .style({
                    opacity: 1.0
                });
            scene.addLayer(pointLayer);
        });

    fetch('https://gw.alipayobjects.com/os/bmw-prod/20a69b46-3d6d-4ab5-b8b5-150b6aa52c88.json')
        .then(res => res.json())
        .then(flydata => {
            const flyLine = new L7.LineLayer({ blend: 'normal' })
                .source(flydata, {
                    parser: {
                        type: 'json',
                        coordinates: 'coord'
                    }
                })
                .color('#b97feb')
                .shape('arc3d')
                .size(0.5)
                .active(true)
                .animate({
                    interval: 2,
                    trailLength: 2,
                    duration: 1
                })
                .style({
                    opacity: 1,
                    segmentNumber: 60,
                    globalArcHeight: 20
                });
            scene.addLayer(flyLine);
        });


    scene.on('loaded', () => {
        scene.addLayer(earthlayer);

        fetch('https://gw.alipayobjects.com/os/bmw-prod/efef6c2b-2922-4c03-b9e0-d3743f68eaf2.json')
            .then(res => res.json())
            .then(data => {
                const pointlayer = new L7.PointLayer()
                    .source(data,
                        {
                            parser: {
                                type: 'json',
                                x: 'lng',
                                y: 'lat'
                            }
                        }
                    )
                    .shape('cylinder')
                    .color('#f00')
                    .size('', () => [ 1, 1, 10 ])
                    .active(true);
                scene.addLayer(pointlayer);
            });

        scene.addLayer(atomLayer);
        scene.addLayer(bloomLayer);

        earthlayer.setEarthTime(4.0);
    });
</script>
</body>
</html>
