<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>创建地图场景</title>
    <style>
        html,body{overflow:hidden;margin:0;}
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>
<div id="map"></div>
<script src="./js/L7.js"></script>
<script>
    // import { GaodeMap } from '@antv/l7-maps';

    const scene = new L7.Scene({
        id: 'map',
        stencil: true,
        map: new L7.Earth({})
    });

    // TODO: 地球模式下背景色默认为 #000 通过 setBgColor 方法我们可以设置可视化层的背景色
    scene.setBgColor('#00142c');

    // 设置地球表面纹理图 可以直接替换图片链接
    const earthlayer = new L7.EarthLayer()
        .source(
            ['./assets/map_001.jpg'],
            // '',
            {
                parser: {
                    type: 'image'
                }
            }
        )
        .color('#2E8AE6')
        .shape('fill')
        .style({
            opacity: 0.5,
            radius: 40,
            // globelOtions: {
            //     ambientRatio: 0, // 环境光
            //     diffuseRatio: 0, // 漫反射
            //     specularRatio: 0 // 高光反射
            // }
        })
        .animate(true);

    // 大气图层
    const atomLayer = new L7.EarthLayer()
        .color('#2E8AE6')
        .shape('atomSphere')
        .style({
            opacity: 1
        });

    // 辉光图层
    const bloomLayer = new L7.EarthLayer().color('#fff').shape('bloomSphere')
        .style({
            opacity: 0.7
        });

    scene.on('loaded', () => {
        scene.addLayer(earthlayer);

        // 飞线
        fetch('https://gw.alipayobjects.com/os/bmw-prod/20a69b46-3d6d-4ab5-b8b5-150b6aa52c88.json')
            .then(res => res.json())
            .then(flydata => {
                const flyLine = new L7.LineLayer({ blend: 'normal' })
                    .source(flydata, {
                        parser: {
                            type: 'json',
                            coordinates: 'coord'
                        }
                    })
                    .color('#BB133E')
                    .shape('arc3d')
                    .size([0.2, 0.1])
                    .active(true)
                    .animate({
                        interval: 0.6, // interval 轨迹间隔, 取值区间 0 - 1
                        trailLength: 0.6, // trailLength 轨迹长度 取值区间 0 - 1
                        duration: 5 // duration 动画时间 单位(s)秒
                    })
                    .style({
                        lineType: 'dash', // 设置虚线
                        dashArray: [5, 5],
                        sourceColor: '#12a1ff', // 起点颜色
                        targetColor: '#00569f', // 终点颜色
                        opacity: 1,
                        segmentNumber: 60,
                        globalArcHeight: 6
                    });
                scene.addLayer(flyLine);
            });


        // 点图层 圆柱点
        fetch('https://gw.alipayobjects.com/os/bmw-prod/efef6c2b-2922-4c03-b9e0-d3743f68eaf2.json')
            .then(res => res.json())
            .then(data => {
                data = [  { "lng": 127.657407, "lat": 49.76027 },
                    { "lng": 129.397818, "lat": 49.4406 },
                    { "lng": 130.582293, "lat": 48.729687 },
                    { "lng": 130.987282, "lat": 47.790132 },
                    { "lng": 132.506672, "lat": 47.78897 },
                    { "lng": 133.373596, "lat": 48.183442 },
                    { "lng": 135.026311, "lat": 48.47823 },
                    { "lng": 134.500814, "lat": 47.57844 },
                    { "lng": 134.112362, "lat": 47.212467 },
                    { "lng": 133.769644, "lat": 46.116927 },
                    { "lng": 133.097127, "lat": 45.144066 },
                    { "lng": 131.883454, "lat": 45.321162 },
                    { "lng": 131.025212, "lat": 44.967953 },]
                const pointlayer = new L7.PointLayer()
                    .source(data,
                        {
                            parser: {
                                type: 'json',
                                x: 'lng',
                                y: 'lat'
                            }
                        }
                    )
                    .shape('hexagonColumn')
                    .color(['#00a0ff'])
                    .size('', () => [ 0.3, 0.3, 23 ])
                    .active(true).style({
                        opacity: 0.6,
                        // 控制 3d 柱状图的背景色 透明
                        opacityLinear: {
                            enable: true, // true - false
                            dir: 'up', // up - down
                        },
                    });
                scene.addLayer(pointlayer);
            });



        // 点图层 圆柱点
        fetch('https://sh-conf.oss-cn-shanghai.aliyuncs.com/datav-coms-data/world2.json')
            .then(res => res.json())
            .then(data => {
                // data = [  { "lng": 127.657407, "lat": 49.76027 },
                //     { "lng": 29.397818, "lat": 49.4406 },
                //     { "lng": 30.582293, "lat": 48.729687 },
                //     { "lng": 30.987282, "lat": 47.790132 },
                //     { "lng": 32.506672, "lat": 47.78897 },
                //     { "lng": 33.373596, "lat": 48.183442 },
                //     { "lng": 35.026311, "lat": 48.47823 },
                //     { "lng": 34.500814, "lat": 47.57844 },
                //     { "lng": 34.112362, "lat": 47.212467 },
                //     { "lng": 33.769644, "lat": 46.116927 },
                //     { "lng": 33.097127, "lat": 45.144066 },
                //     { "lng": 31.883454, "lat": 45.321162 },
                //     { "lng": 131.025212, "lat": 44.967953 },]
                const pointlayer = new L7.PointLayer()
                    .source(data,
                        {
                            parser: {
                                type: 'json',
                                x: 'lng',
                                y: 'lat'
                            }
                        }
                    )
                    .shape('hexagonColumn')
                    .color(['#00a0ff'])
                    .size('', () => [ 0.3, 0.3, 5 ])
                    .active(true).style({
                        opacity: 0.6,
                        // 控制 3d 柱状图的背景色 透明
                        opacityLinear: {
                            enable: true, // true - false
                            dir: 'down', // up - down
                        },
                    });
                scene.addLayer(pointlayer);
            });

        // 圆环 水波纹 展示店点
        fetch('https://gw.alipayobjects.com/os/bmw-prod/efef6c2b-2922-4c03-b9e0-d3743f68eaf2.json')
            .then(res => res.json())
            .then(data => {
                data = [
                    { "lng": 86.598776, "lat": 78.549182 },
                    { "lng": 87.35997, "lat": -9.214981 },
                    { "lng": 127.751264, "lat": 49.297198 },
                    { "lng": 38.013832, "lat": 48.599463 },
                    { "lng": 68.854298, "lat": 48.069082 },
                    { "lng": 122.280826, "lat": 47.693549 },
                    { "lng": 90.970809, "lat": 46.888146 },
                    { "lng": 90.585768, "lat": 45.719716 },
                    // { "lng": 90.94554, "lat": 45.286073 },
                    // { "lng": 92.133891, "lat": 45.115076 },
                    // { "lng": 323.480734, "lat": 44.975472 },
                    // { "lng": 94.688929, "lat": 44.352332 },
                    // { "lng": 95.306875, "lat": 44.241331 },
                    // { "lng": 125.762455, "lat": 43.319449 },
                    // { "lng": 96.349396, "lat": 42.725635 },
                    // { "lng": 87.451757, "lat": 42.74889 },
                    // { "lng": 89.515817, "lat": 42.524691 },
                    // { "lng": 90.845866, "lat": 42.663804 },
                    // { "lng": 60.83304, "lat": 42.514873 },
                    // { "lng": 313.32278, "lat": 41.907468 },
                ]
                const pointlayer = new L7.PointLayer()
                    .source(data,
                        {
                            parser: {
                                type: 'json',
                                x: 'lng',
                                y: 'lat'
                            }
                        }
                    )
                    .shape('circle')
                    .color('#f00')
                    .active(true)
                    .animate(true)
                    .size(70)
                    .active(true);

                scene.addLayer(pointlayer);
            });



        scene.addLayer(atomLayer);
        scene.addLayer(bloomLayer);
        earthlayer.setEarthTime(4.0);
    });


</script>
</body>
</html>
